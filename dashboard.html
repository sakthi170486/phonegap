<!DOCTYPE html>
<html lang="en">
	<head>
		<title>Navigator</title>
		<meta charset="utf-8">
		<meta name="viewport" content="width=device-width, initial-scale=1">
		<link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css">
		<link rel="stylesheet" href="css/bootstrap.css">
		<link rel="stylesheet" href="css/jquery.mCustomScrollbar.css">
	</head>
	<body>
		<div class="inner-content">
			<div class="maincontent bg-color">
				<div class="wrapper">
					<!-- Sidebar -->
					<nav id="sidebar">
						<div class="sidebar-header">
							<img src="img/camera.png" id="uimg" class="img-responsive" alt="Profile Image"/>
						</div>
						<ul class="list-unstyled components">
							<p id="uname">Welcome Guest</p><hr/>
							<!--<li class="active">
								<a href="#homeSubmenu" data-toggle="collapse" aria-expanded="false" class="dropdown-toggle">Home</a>
								<ul class="collapse list-unstyled" id="homeSubmenu">
									<li>
										<a href="#">Home 1</a>
									</li>
									<li>
										<a href="#">Home 2</a>
									</li>
									<li>
										<a href="#">Home 3</a>
									</li>
								</ul>
							</li>-->
							<li class="active"><a href="MyAccount" class="lnk"><i class="fa fa-user"></i> My Account</a></li>
							<li><a href="AddCustomer" class="lnk"><i class="fa fa-user-plus"></i> Add Customer</a></li>
							<li><a href="Dashboard" class="lnk"><i class="fa fa-search"></i> Search Customer</a></li>
							<li><a href="#" id="logout"><i class="fa fa-sign-out"></i> Logout</a></li>					
						</ul>
					</nav>
					<div id="content">
						 <nav class="navbar navbar-expand-lg">
							<div class="container-fluid">
								<span id="sidebarCollapse" class="text-white">
									<i class="fa fa-bars"></i> 
								</span>
							</div>
						</nav>																
					</div>
					
					<div class="getcontent">
						
					</div>
					<div id="photo" class="modal fade" role="dialog">
						<div class="modal-dialog">
							<div class="modal-content">
								<div class="modal-header">
									<p class="modal-title text-center w-100 font-weight-bold">Upload Photo</p>
									<span class="close" data-dismiss="modal">&times;</span>									
								</div>
								<div class="modal-body text-center">
									<button id='but_take' class="btn btn-outline-primary">Take photo</button><br/>
									<button id='but_select' class="btn btn-outline-info mt-1">Select photo from Gallery</button>									
								</div>
							</div>
						</div>	
					</div>
				</div>
			</div>
		</div>
	</body>
	<script id="dashboard-tpl" type="text/x-handlebars-template">			
		<div class="container inner-container mt-5">
			<div class="row">
				<div class="col-md-1 d-none d-md-block">
				</div>
				<div class="col-md-10 col-sm-12 mx-auto">
					<form action="#" class="text-white">								
						<div class="form-group has-search">
							 <span class="fa fa-search form-control-feedback"></span>
							<input class='form-control search-key w-70' placeholder="Search Customer" id="srchcus" type="search"/>
						</div>
					</form>	
					<hr/>
					<div class="details">
						<div class="scroll">
							<div class="text-center mt-5" id="loader">
								<img src="img/ajax-loader.gif" alt="" class="img-responsive"/>
							</div>
							<ul class='customer-list'>
								
							</ul>
						</div>
					</div>
				</div>
				<div class="col-md-1">
				</div>
			</div>
		</div>		
	</script>
	<script id="addcustomer-tpl" type="text/x-handlebars-template">
		<div class="container inner-container mt-5">
			<div class="h-100 row align-items-center">
				<div class="col-md-1 d-none d-md-block">
				</div>
				<div class="col-md-10 col-sm-12 mx-auto">						
					<h3 class="text-center text-white">Add Customer</h3><br/>					
					<form action="#" class="text-white" name="cusreg" id="cusreg">
						<div class="form-group">
							<input type="text" class="form-control" required placeholder="Customer Name *" name="cname" id="cname">
						</div>						
						<div class="form-group">
							<input type="tel" class="form-control" required placeholder="Mobile Number *" name="mobile" id="mobile">
						</div>						
						<div class="form-group">
							<input type="email" class="form-control" placeholder="Email address *" required name="email" id="email">
						</div>	
						<div class="form-group">
							<input type="text" class="form-control" required placeholder="Address *" name="addr" id="addr">
						</div>
						<div class="form-group">
							<input type="text" class="form-control" placeholder="City" name="city" id="city">
						</div>
						<div class="form-group">
							<input type="text" class="form-control" placeholder="State" name="state" id="state">
						</div>
						<div class="form-group">
							<input type="text" class="form-control" placeholder="Country" name="country" id="country">
						</div>
						<div class="form-group">
							<input type="tel" class="form-control" placeholder="Pincode" name="pincode" id="pincode">
							<input type="hidden" class="form-control" name="compid" id="compid">
						</div>
						<div class="form-group text-center">
						<a id="" href="Dashboard" class="btn form-btn pt-3 lnk">Cancel</a>
						<button type="submit" class="btn form-btn" name="insert" id="insert" >Submit</button>
						</div>
					</form>	
				</div>
				<div class="col-md-1"></div>
			</div>
		</div>
	</script>
	<script id="myaccount-tpl" type="text/x-handlebars-template">
		<div class="container inner-container mt-5">
			<div class="h-100 row align-items-center">
				<div class="col-md-1 d-none d-md-block">
				</div>
				<div class="col-md-10 col-sm-12 mx-auto text-white">	
					<h3 class="text-center text-white" id="ptitle" >My Profile</h3><hr/>
					<a href="" class="float-right" id="pedit">Profile Edit <i class="fa fa-edit"></i></a>
					
					<div class="clearfix"></div>
					<div class="d-none" id="eprofile">					
						<form action="#" class="text-white" name="reg" id="reg">
							<div class="form-group">
								<input type="text" class="form-control" required placeholder="Company Name *" name="ecname" id="ecname">
							</div>
							<div class="form-group">
								<input type="text" class="form-control" required placeholder="Your Name *" name="ename" id="ename">
							</div>
							<div class="form-group">
								<input type="tel" class="form-control" required placeholder="Mobile Number *" name="emobile" id="emobile">
							</div>
							<div class="form-group">
								<input type="tel" class="form-control" placeholder="Alternative Number" name="altmobile" id="altmobile">
							</div>
							<div class="form-group">
								<input type="email" class="form-control" placeholder="Email address *" required name="eemail" id="eemail">
								<input type="hidden" class="form-control" name="imgname" id="imgname">
								<input type="hidden" class="form-control" name="eid" id="eid">
							</div>	
							<div class="form-group text-center">
								<a id="" href="" class="btn form-btn pt-3 cncl">Cancel</a>
								<button type="submit" class="btn form-btn reg" name="update" id="update" >Update</button>
							</div>
						</form>	
					</div>
					<div class="row" id="vprofile">					
						<div class='col-4 col-md-4 col-sm-4'>
							<img src="img/camera.png" id="profimg" class="img-responsive" alt="Profile Image"/><a href="" title="change photo" id="epic" data-toggle="modal" data-target="#photo"><i class="fa fa-camera"></i></a>
						</div>
						<div class='col-8 col-md-8 col-sm-8'>
							<p id="mcompname"></p>
							<p id="mname"></p>
							<p id="memail"></p>
							<p id="mphone"></p>
							<p id="maltnum"></p>
						</div>
					</div>					
				</div>
				<div class="col-md-1"></div>
			</div>
		</div>
	</script>
	<script id="customer-tpl" type="text/x-handlebars-template">
		<div class="container inner-container mt-5">
			<div class="h-100 row align-items-center">
				<div class="col-md-1 d-none d-md-block">
				</div>
				<div class="col-md-10 col-sm-12 mx-auto text-white">	
					<h3 class="text-center text-white" id="cptitle" >Customer Profile</h3><hr/>
					<div class="clearfix"></div>
					<div class="d-none" id="ecusprofile">					
						<form action="#" class="text-white" name="ecusreg" id="ecusreg">
						<div class="form-group">
							<input type="text" class="form-control" required placeholder="Customer Name *" name="ecusname" id="ecusname">
						</div>						
						<div class="form-group">
							<input type="tel" class="form-control" required placeholder="Mobile Number *" name="mobile" id="mobile">
						</div>						
						<div class="form-group">
							<input type="email" class="form-control" placeholder="Email address *" required name="email" id="email">
						</div>	
						<div class="form-group">
							<input type="text" class="form-control" required placeholder="Address *" name="ecusaddr" id="ecusaddr">
						</div>
						<div class="form-group">
							<input type="text" class="form-control" placeholder="City" name="ecuscity" id="ecuscity">
						</div>
						<div class="form-group">
							<input type="text" class="form-control" placeholder="State" name="ecusstate" id="ecusstate">
						</div>
						<div class="form-group">
							<input type="text" class="form-control" placeholder="Country" name="ecuscountry" id="ecuscountry">
						</div>
						<div class="form-group">
							<input type="tel" class="form-control" placeholder="Pincode" name="ecuspincode" id="ecuspincode">
							<input type="hidden" class="form-control" name="ecusid" id="ecusid">
						</div>
						<div class="form-group text-center">
						<a id="" href="" class="btn form-btn pt-3 ecncl">Cancel</a>
						<button type="submit" class="btn form-btn" name="cusupdate" id="cusupdate" >Update</button>
						</div>
					</form>	
					</div>
					<div class="row" id="vcusprofile">
						<a href="" class="float-right" id="cusedit">Profile Edit <i class="fa fa-edit"></i></a>
						<a href="Dashboard" class="lnk" id="cusbck"><i class="fa fa-arrow-left"></i> Back </a>
						<div class='col-12 col-md-12 col-sm-12'>
							<p id="vcusname"></p>
							<p id="vcusemail"></p>
							<p id="vcusphone"></p>
							<p id="vcusaddr"></p>
							<p id="vcuscity"></p>
							<p id="vcusstate"></p>
							<p id="vcuscountry"></p>
							<p id="vcuspincode"></p>
						</div>
					</div>					
				</div>
				<div class="col-md-1"></div>
			</div>
		</div>
	</script>
	
	
	<script src="phonegap.js"></script>
	<script type="text/javascript" charset="utf-8" src="cordova.js"></script>
	<script src="js/jquery.min.js"></script>
	<script src="js/popper.min.js"></script>
	<script src="js/bootstrap.min.js"></script>	
	<script src="lib/handlebars.js"></script>
	<script src="js/jquery-ui.js"></script>
	<script src="js/jquery.mCustomScrollbar.concat.min.js"></script>	
	<script src="js/dashboard.js"></script>
	<script type="text/javascript">
		window.onload = function()
		{
			var lgn=window.localStorage.getItem('loginstatus');
			if(lgn != 'true')
			{
				window.location.href="index.html";
			}
		}
		
		// Change image source and upload photo to server
		function onSuccess(imageURI) {
			// Set image source
			var image = document.getElementById('profimg');
			image.src = imageURI  + '?' + Math.random();

			var options = new FileUploadOptions();
			options.fileKey = "file";
			options.fileName = imageURI.substr(imageURI.lastIndexOf('/') + 1);
			options.mimeType = "image/jpeg";

			var params = {};
			params.value1 = "test";
			params.value2 = "param";

			options.params = params;
			options.chunkedMode = false;
			var uid=window.localStorage.getItem('lgnid');
			var ft = new FileTransfer();
			ft.upload(imageURI, "http://www.azillesoft.com/phonegap/database/upload.php?a=u&id="+uid, function(result){
				//alert('successfully uploaded ' + result.response);
				$('#photo').modal('hide');				
			}, function(error){
				alert('error : ' + JSON.stringify(error));
			}, options);
		}
		
		function onFail(message) {
			alert('Failed because: ' + message);
		}
				
		function getlist(s = '')
		{
			var id=window.localStorage.getItem('lgnid');
			$('.getcontent .customer-list').html('');
			$.ajax({
				type: "POST",
				url:"http://www.azillesoft.com/phonegap/database/cusjson.php",
				data : 'u='+id+'&c='+s, // post data || get data
				dataType : 'json', // data type
				crossDomain: true,
				cache: false,
				beforeSend: function(){ $('.getcontent #loader').show();},
				success: function(result){
					if(result.length > 0) 
					{		
						$('.getcontent #loader').hide();
						$.each(result, function(i, field){
							 var id=field.id;
							 var name=field.name;
							$('.getcontent .customer-list').append('<li><a class="vcus" href="'+id+'">'+name+'</a></li>');
						});	
					}					
				}
			});
		}
		
		function getmydet()
		{
			var uid=window.localStorage.getItem('uid');
			$.ajax({
				type: "POST",
				url:"http://www.azillesoft.com/phonegap/database/json.php",
				data : 'u='+uid, // post data || get data
				dataType : 'json', // data type
				crossDomain: true,
				cache: false,
				success: function(result){
					if( result.length > 0) 
					{
						$.each(result, function(i, field){
							var id=field.id;
							var cname=field.company_name;
							var name=field.name;
							var mobile=field.phonenumber;
							var emailid=field.emailid;
							var altnum=field.alternumber;
							var img=field.profilepic;
							if(img != '')
							{
								$('#uimg').attr('src','http://www.azillesoft.com/phonegap/database/upload/'+img);
								$('#profimg').attr('src','http://www.azillesoft.com/phonegap/database/upload/'+img);
							}
							$('.getcontent #mcompname').text('Company Name : '+cname);
							$('.getcontent #mname').text('Name : '+name);
							$('.getcontent #memail').text('Email Id : '+emailid);
							$('.getcontent #mphone').text('Contact Number : '+mobile);
							$('.getcontent #maltnum').text('Alternate Number : '+altnum);
							
							$('.getcontent #ecname').val(cname);
							$('.getcontent #ename').val(name);
							$('.getcontent #eemail').val(emailid);
							$('.getcontent #emobile').val(mobile);
							$('.getcontent #altmobile').val(altnum);
							$('.getcontent #imgname').val(img);
							$('.getcontent #eid').val(id);
							
							$('#uname').text('Welcome '+name);
						});	
					}					
				}
			});
		}
		
		function getcusdet(id)
		{
			$.ajax({
				type: "POST",
				url:"http://www.azillesoft.com/phonegap/database/cusdetails.php",
				data : 'u='+id, // post data || get data
				dataType : 'json', // data type
				crossDomain: true,
				cache: false,
				success: function(result){
					if( result.length > 0) 
					{
						$.each(result, function(i, field){
							var id=field.id;
							var cname=field.name;
							var addr=field.address;
							var mobile=field.phonenumber;
							var emailid=field.emailid;
							var city=field.city;
							var state=field.state;
							var country=field.country;
							var pincode=field.pincode;
							
							$('.getcontent #vcusname').text('Name : '+cname);
							$('.getcontent #vcusemail').text('Email Id : '+emailid);
							$('.getcontent #vcusphone').text('Contact Number : '+mobile);
							$('.getcontent #vcusaddr').text('Address : '+addr);
							$('.getcontent #vcuscity').text('City : '+city);
							$('.getcontent #vcusstate').text('State : '+state);
							$('.getcontent #vcuscountry').text('Country : '+country);
							$('.getcontent #vcuspincode').text('Pincode : '+pincode);
							
							$('.getcontent #ecusname').val(cname);
							$('.getcontent #email').val(emailid);
							$('.getcontent #mobile').val(mobile);
							$('.getcontent #ecusaddr').val(addr);
							$('.getcontent #ecuscity').val(city);
							$('.getcontent #ecusstate').val(state);
							$('.getcontent #ecuscountry').val(country);
							$('.getcontent #ecuspincode').val(pincode);
							$('.getcontent #ecusid').val(id);
						});	
					}					
				}
			});
		}
		
		$.fn.serializeObject = function()
		{
			var o = {};
			var a = this.serializeArray();
			$.each(a, function() {
				if (o[this.name] !== undefined) {
					if (!o[this.name].push) {
						o[this.name] = [o[this.name]];
					}
					o[this.name].push(this.value || '');
				} else {
					o[this.name] = this.value || '';
				}
			});
			return o;
		};	
		
		function SaveDataToLocalStorage(data)
		{		
			var a = [];
			// Parse the serialized data back into an aray of objects
			if(localStorage.getItem('cusdet') !== null)
			{
				a = [JSON.parse(localStorage.getItem('cusdet'))];
			}
			// Push the new data (whether it be an object or anything else) onto the array
			if(a == null || a.length === 0)
			{
				a = JSON.parse(data);
			}
			else
			{				
				a.push(data);
			}			
			// Re-serialize the array back into a string and store it in localStorage
			localStorage.setItem('cusdet', JSON.stringify(a));
			
		}
		
		$(function()
		{
			getmydet();
			getlist();
			
			// take picture from camera
			$('body').on('click','#but_take',function(){
				navigator.camera.getPicture(onSuccess, onFail, { quality: 20,
					destinationType: Camera.DestinationType.FILE_URL 
				});
			});

			// upload select 
			$('body').on('click','#but_select',function(){
				navigator.camera.getPicture(onSuccess, onFail, { quality: 50,
					sourceType: Camera.PictureSourceType.PHOTOLIBRARY, 
					allowEdit: true,
					destinationType: Camera.DestinationType.FILE_URI
				});
			}); 
			
			$('.maincontent').on('click', '#sidebarCollapse',function () {
				$('#sidebar').toggleClass('active');
			});	
			
			$('.maincontent').on('click', '#logout',function () {
				localStorage.clear();
				window.location.href="index.html";
			});
			
			$('body').on('click','#pedit',function(e){
				e.preventDefault();
				$('#vprofile').addClass('d-none');
				$('#eprofile').removeClass('d-none');
				$('#ptitle').text('Edit Profile');
				$(this).hide();
			});
			
			$('body').on('click','.cncl',function(e){
				e.preventDefault();
				$('#eprofile').addClass('d-none');
				$('#vprofile').removeClass('d-none');
				$('#ptitle').text('My Profile');
				$('#pedit').show();
			});
			
			$('body').on('click','.vcus',function(e){
				e.preventDefault();
				var id=$(this).attr('href');				
				var template = Handlebars.compile($("#customer-tpl").html());
				var options = {direction:'right'};
				$('.getcontent').html('');
				$( ".getcontent" ).effect( 'slide', options, 300, function(){					
					$('.getcontent').html(template);
					getcusdet(id);
					$('#sidebar').removeClass('active');					
				});
			});
			
			$('body').on('click','#cusedit',function(e){
				e.preventDefault();
				$('#vcusprofile').addClass('d-none');
				$('#ecusprofile').removeClass('d-none');
				$('#cptitle').text('Edit Customer Profile');
			});
			
			$('body').on('click','.ecncl',function(e){
				e.preventDefault();
				$('#ecusprofile').addClass('d-none');
				$('#vcusprofile').removeClass('d-none');
				$('#cptitle').text('Customer Profile');
			});
			
			// open the corresponding page
			$('body').on('click','.lnk',function(e){
				e.preventDefault();
				$('li').removeClass('active');
				$(this).parent().addClass('active');
				// Most effect types need no options passed by default
				
				var l=$(this).attr('href').toLowerCase();	
				
				if(l == 'dashboard')
					window.localStorage.setItem('firstpage',1);
				else
					window.localStorage.setItem('firstpage',0);
					
				var template = Handlebars.compile($("#"+l+"-tpl").html());
				var options = {direction:'right'};
				$('.getcontent').html('');
				$( ".getcontent" ).effect( 'slide', options, 300, function(){
					
					$('.getcontent').html(template);
					$('#sidebar').removeClass('active');
					if(l=='dashboard')
					{
						getlist();
					}
					if(l=='myaccount')
					{
						getmydet();
					}
				});				
			});
			
			// Check my mobile number already registered or not
			$("body").on('blur','#emobile',function(e){
				var v=$(this).val();
				var id = window.localStorage.getItem('lgnid');
				if(v.length > 0)
				{
					$.ajax({
						type: "POST",
						url:"http://www.azillesoft.com/phonegap/database/checkumobile.php",
						data : 'm='+v+'&id='+id, // post data || get data
						crossDomain: true,
						cache: false,
						success: function(data){
							if(data == "exists")
							{	
								alert("Mobile number already registered.");
								$("#emobile").val('').focus();															
							}						
						}
					});
				}
			});
			
			// Check customer mobile number already registered or not
			$("body").on('blur','#mobile',function(e){
				var v=$(this).val();
				var id=window.localStorage.getItem('lgnid');
				var cid = $('#ecusid').val();
				if(v.length > 0)
				{
					$.ajax({
						type: "POST",
						url:"http://www.azillesoft.com/phonegap/database/checkcusmobile.php",
						data : 'm='+v+'&id='+id+'&cid='+cid, // post data || get data
						crossDomain: true,
						cache: false,
						success: function(data){
							if(data == "exists")
							{
								alert("Mobile number already registered.");
								$("#mobile").val('').focus();															
							}						
						}
					});
				}
			});	
			
			
			
			
			// insert customer data to server
			$("body").on('click','#insert',function(e){
				e.preventDefault();	
				$('#compid').val(window.localStorage.getItem('lgnid'));
				var cname=$("#cname").val();
				var addr=$("#addr").val();
				var mobile=$("#mobile").val();
				var email=$("#email").val();
				if($.trim(cname).length > 0 && $.trim(addr).length > 0 && $.trim(mobile).length > 0 && $.trim(email).length > 0)
				{
					 atpos = email.indexOf("@");
					 dotpos = email.lastIndexOf(".");				 
					 if (atpos < 1 || ( dotpos - atpos < 2 )) {
						alert("Please enter correct email ID")
						$("#email").focus() ;
						return false;
					 }
					 if(isNaN( mobile ) ||$.trim(mobile).length != 10 ) {					
						alert( "Please provide a valid mobile number." );
						$("#mobile").focus() ;
						return false;
					 }				
				
					
						
					/*var data = (JSON.stringify($('#cusreg').serializeObject()));					
					
					SaveDataToLocalStorage(data);
					var employees = localStorage.getItem('cusdet');
					
					$.ajax({
						type: "POST",
						url:"database/getcustomer.php",
						data : 'd='+employees, // post data || get data						
						success: function(data){
							if(data=="success")
							{
								alert("inserted");
								$("#insert").text('Submit');
								$("#cusreg")[0].reset();
							}
							else if(data=="error")
							{
								alert("error");	
							}
						}
					});*/
					
					
					$.ajax({
						type: "POST",
						url:"http://www.azillesoft.com/phonegap/database/insertcustomer.php",
						data : $("#cusreg").serialize(), // post data || get data
						crossDomain: true,
						cache: false,
						beforeSend: function(){ $("#insert").text('Connecting...');},
						success: function(data){
							if(data=="success")
							{
								alert("inserted");
								$("#insert").text('Submit');
								$("#cusreg")[0].reset();
							}
							else if(data=="error")
							{
								alert("error");	
							}
						}
					});
				}
				else 
				{				
					alert("Enter all the required fields");
				}
				return false;
			});				
		
			// update my details to server
			$("body").on('click','#update',function(e){
				e.preventDefault();	
				var cname=$("#ecname").val();
				var name=$("#ename").val();
				var mobile=$("#emobile").val();
				var amobile=$("#altmobile").val();
				var email=$("#eemail").val();			
				var imgname=$("#imgname").val();
				if($.trim(ecname).length > 0 && $.trim(ename).length > 0 && $.trim(emobile).length > 0 && $.trim(eemail).length > 0)
				{				
					 atpos = email.indexOf("@");
					 dotpos = email.lastIndexOf(".");				 
					 if (atpos < 1 || ( dotpos - atpos < 2 )) {
						alert("Please enter correct email ID")
						$("#eemail").focus() ;
						return false;
					 }
					 if(isNaN( mobile ) ||$.trim(mobile).length != 10 ) {					
						alert( "Please provide a valid mobile number." );
						$("#emobile").focus() ;
						return false;
					 }
					if( amobile != '' && $.trim(amobile).length != 10 ) {					
						alert( "Please provide a valid alternate number." );
						$("#altmobile").focus() ;
						return false;
					 }		
				
					$.ajax({
						type: "POST",
						url:"http://www.azillesoft.com/phonegap/database/update.php",
						//dataType : 'json', // data type
						data : $("#reg").serialize(), // post data || get data
						crossDomain: true,
						cache: false,
						beforeSend: function(){ $("#update").text('Connecting...');},
						success: function(data){
							if(data=="success")
							{
								alert("updated");
								$("#update").text('Update');
								getlist();
								$('#eprofile').addClass('d-none');
								$('#vprofile').removeClass('d-none');
								$('#ptitle').text('My Profile');
								$('#pedit').show();
								/*var myaccTpl = Handlebars.compile($("#myaccount-tpl").html());	
								$('.getcontent').html(myaccTpl);*/
								
							}
							else if(data=="error")
							{	
								alert("error");	
								$('#eprofile').addClass('d-none');
								$('#vprofile').removeClass('d-none');
								$('#ptitle').text('My Profile');
								$('#pedit').show();
								//$("#reg")[0].reset();
							}
						}
					});
				}
				else 
				{					
					alert("Enter all the required fields");
					//$("#reg")[0].reset();
				}
				return false;
			});
			
			
			// update customer data to server
			$("body").on('click','#cusupdate',function(e){
				e.preventDefault();	
				var cname=$("#ecusname").val();
				var id=$("#ecusid").val();
				var addr=$("#ecusaddr").val();
				var mobile=$("#mobile").val();
				var email=$("#email").val();
				if($.trim(cname).length > 0 && $.trim(addr).length > 0 && $.trim(mobile).length > 0 && $.trim(email).length > 0)
				{				
					 atpos = email.indexOf("@");
					 dotpos = email.lastIndexOf(".");				 
					 if (atpos < 1 || ( dotpos - atpos < 2 )) {
						alert("Please enter correct email ID")
						$("#email").focus() ;
						return false;
					 }
					 if(isNaN( mobile ) ||$.trim(mobile).length != 10 ) {					
						alert( "Please provide a valid mobile number." );
						$("#mobile").focus() ;
						return false;
					 }				
				
					$.ajax({
						type: "POST",
						url:"http://www.azillesoft.com/phonegap/database/updatecustomer.php",
						data : $("#ecusreg").serialize(), // post data || get data
						crossDomain: true,
						cache: false,
						beforeSend: function(){ $("#cusupdate").text('Connecting...');},
						success: function(data){
							if(data=="success")
							{
								alert("updated");
								$("#cusupdate").text('Update');								
								getcusdet(id);
								$('#ecusprofile').addClass('d-none');
								$('#vcusprofile').removeClass('d-none');
								$('#cptitle').text('Customer Profile');
								$('#cusedit').show();
								
								
							}
							else if(data=="error")
							{	
								alert("error");	
								$("#cusupdate").text('Update');	
								$('#ecusprofile').addClass('d-none');
								$('#vcusprofile').removeClass('d-none');
								$('#cptitle').text('Customer Profile');
								$('#cusedit').show();
								//$("#reg")[0].reset();
							}
						}
					});
				}
				else 
				{				
					alert("Enter all the required fields");
				}
				return false;
			});	
		
			// filter customer list
			$('body').on('keyup','#srchcus',function(){
				var c= $(this).val();				
				getlist(c);
			});
		
		});
	</script>
</html>